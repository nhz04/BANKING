<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Accounts - 404 Finance</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link href="https://cdn.jsdelivr.net/npm/remixicon/fonts/remixicon.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;700&display=swap" rel="stylesheet">
</head>
<body>
    
    <!-- =================== NAVIGATION =================== -->
    <nav class="navbar">
        <div class="logo">
            <img src="{{ url_for('static', filename='logo.png') }}" alt="Logo">
            <span>404 FINANCE</span>
        </div>
        <ul class="nav-links">
            <li>
                <a href="{{ url_for('dashboard') }}" class="{% if active_page == 'dashboard' %}active{% endif %}">
                    <i class="ri-dashboard-fill"></i> Dashboard
                </a>
            </li>
            <li>
                <a href="{{ url_for('accounts_page') }}" class="{% if active_page == 'accounts' %}active{% endif %}">
                    <i class="ri-account-circle-fill"></i> Accounts
                </a>
            </li>
            <li>
                <a href="{{ url_for('transactions_page') }}" class="{% if active_page == 'transactions' %}active{% endif %}">
                    <i class="ri-arrow-left-right-fill"></i> Transactions
                </a>
            </li>
        </ul>
    </nav>


    <!-- Flash Messages -->
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        <div class="flash-messages">
          {% for category, message in messages %}
            <div class="flash {{ category }}">{{ message }}</div>
          {% endfor %}
        </div>
      {% endif %}
    {% endwith %}




<!-- =================== ACCOUNT CONTENT =================== -->



<div class="content-dashboard">


    <div class="accounts-header">
        <h1>Account Management</h1>
        <button class="btn-create-account" onclick="openModal('createAccountModal')">
            <i class="ri-add-line"></i> Create New Account
        </button>
    </div>

  
    <div class="accounts-list">
        {% if accounts %}
            {% for acc_no, acc in accounts.items() %}
            <div class="account-card">

               
                <div class="account-info">
                    <p><strong>Name:</strong> {{ acc.name }}</p>
                    <p><strong>Account #:</strong> {{ acc_no }}</p>
                    <p><strong>Created At:</strong> {{ acc.created_at if acc.created_at else "N/A" }}</p>
                    <p><strong>Current Balance:</strong> â‚±{{ "{:,.2f}".format(acc.balance) }}</p>
                </div>

                
                <div class="account-actions">
                    <button class="btn-deposit" onclick="openModal('depositModal', '{{ acc_no }}')">
                        <i class="ri-add-line"></i> Deposit
                    </button>
                    <button class="btn-withdraw" onclick="openModal('withdrawModal', '{{ acc_no }}')">
                        <i class="ri-subtract-line"></i> Withdraw
                    </button>
<button class="btn-history" onclick="location.href='{{ url_for('get_transactions') }}?acc_no={{ acc_no }}'">
    <i class="ri-time-line"></i> History
</button>

                    <form action="{{ url_for('delete_account', acc_no=acc_no) }}" method="POST" class="delete-form" style="display:inline;">
                        <button type="button" class="btn-delete" data-acc-no="{{ acc_no }}">
                            <i class="ri-delete-bin-line"></i> Delete
                        </button>
                    </form>
                </div>

            </div>
            {% endfor %}
        {% else %}
            <p>No accounts found.</p>
        {% endif %}
    </div>

</div>


<div id="deleteModal" class="modal">
    <div class="modal-content">
        <p id="deleteMessage"></p>
        <div class="modal-buttons">
            <button id="cancelBtn">Cancel</button>
            <button id="confirmBtn">Delete</button>
        </div>
    </div>
</div>


<div id="createAccountModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeModal('createAccountModal')">&times;</span>
        <h2>Create Account</h2>
        <form action="{{ url_for('create_account') }}" method="POST">
            <label>Account Number (6 digits):</label>
            <input type="number" name="acc_no" min="0" maxlength="6" required>
            <label>Account Holder Name:</label>
            <input type="text" name="name" required>
            <label>Initial Balance:</label>
            <input type="number" step="0.01" name="balance" min="0" required>
            <button type="submit">Create</button>
        </form>
    </div>
</div>


<div id="depositModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeModal('depositModal')">&times;</span>
        <h2>Deposit</h2>
        <form action="{{ url_for('deposit') }}" method="POST">
            <label>Account Number:</label>
            <input type="number" name="acc_no" min="0" required>
            <label>Amount:</label>
            <input type="number" step="0.01" name="amount" min="0.01" required>
            <button type="submit">Deposit</button>
        </form>
    </div>
</div>


<div id="withdrawModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeModal('withdrawModal')">&times;</span>
        <h2>Withdraw</h2>
        <form action="{{ url_for('withdraw') }}" method="POST">
            <label>Account Number:</label>
            <input type="text" name="acc_no" required>
            <label>Amount:</label>
            <input type="number" step="0.01" name="amount" required>
            <button type="submit">Withdraw</button>
        </form>
    </div>
</div>








<script>
/* ================= MODAL FUNCTIONS ================= */


function openModal(id, acc_no = '') {
    const modal = document.getElementById(id);
    if (!modal) return;

    const input = modal.querySelector('input[name="acc_no"]');
    if (input) input.value = acc_no;

    modal.style.display = "flex";
}


function closeModal(id) {
    const modal = document.getElementById(id);
    if (modal) modal.style.display = "none";
}

/* ================ DELETE ACCOUNT MODAL ================ */

const deleteModal = document.getElementById('deleteModal');
const deleteMessage = document.getElementById('deleteMessage');
const cancelBtn = document.getElementById('cancelBtn');
const confirmBtn = document.getElementById('confirmBtn');


document.querySelectorAll('.btn-delete').forEach(button => {
    button.addEventListener('click', function(e) {
        e.preventDefault(); 

        const acc_no = this.dataset.accNo;
        deleteMessage.textContent = `Are you sure you want to delete account ${acc_no}?`;
        deleteModal.style.display = "flex";

      
        confirmBtn.onclick = () => {
            this.closest('form').submit();
        };
    });
});


cancelBtn.addEventListener('click', () => closeModal('deleteModal'));
window.addEventListener('click', (e) => {
    if (e.target === deleteModal) closeModal('deleteModal');
});
</script>






</body>
</html>
